// Sync values from process.env (SSR/.env) into runtime-config.js for CSR at dev/build time.
// If no env overrides are provided, the script preserves the existing file (so you can edit it manually).
// Usage:
//   node scripts\write-runtime-config.js
// This will write src/assets/runtime-config.js with values from env if provided.

import fs from 'node:fs';
import path from 'node:path';
import 'dotenv/config';

const api = (process.env.API_BASE_URL || '').trim();
const app = (process.env.FRONTEND_BASE_URL || '').trim();

if (!api && !app) {
  console.log('No API_BASE_URL/FRONTEND_BASE_URL in env. Preserving existing runtime-config.js');
  process.exit(0);
}

const out = `// Auto-generated by scripts/write-runtime-config.js\n`
  + `// Do not edit this file manually if you rely on .env overrides.\n`
  + `window.__API_BASE_URL__ = ${api ? JSON.stringify(api) : 'window.__API_BASE_URL__ || undefined'};\n`
  + `window.__FRONTEND_BASE_URL__ = ${app ? JSON.stringify(app) : 'window.__FRONTEND_BASE_URL__ || undefined'};\n`;

const target = path.resolve('src/assets/runtime-config.js');
fs.writeFileSync(target, out, 'utf8');
console.log('Wrote runtime-config.js with API_BASE_URL=%s FRONTEND_BASE_URL=%s', api || '(leave)', app || '(leave)');
