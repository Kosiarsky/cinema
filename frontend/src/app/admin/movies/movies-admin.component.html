<ng-container *ngIf="editingId">
  <h2 class="red-border-bar-profile mb-3">Edycja filmu</h2>
  <form class="row g-1 mb-3" #f="ngForm" (ngSubmit)="saveEdit(f)">
      <div class="col-md-4"><input class="form-control form-control-sm" [(ngModel)]="form.title" name="title" placeholder="Tytuł" required></div>
      <div class="col-md-4">
          <input type="number" class="form-control form-control-sm" [(ngModel)]="form.durationMinutes" name="durationMinutes" placeholder="Czas trwania (minuty)" min="1" required>
          <small *ngIf="form.durationMinutes">Zostanie zapisane jako: {{ formatDurationPreview(form.durationMinutes) }}</small>
      </div>
      <div class="col-md-4"><input class="form-control form-control-sm" [(ngModel)]="form.cast" name="cast" placeholder="Obsada (lista, przecinkami)" required></div>
      <div class="col-12"><textarea class="form-control form-control-sm" rows="3" [(ngModel)]="form.description" name="description" placeholder="Opis" required></textarea></div>
      
      <div class="col-12 mb-2 pb-2 d-flex flex-wrap gap-3">
          <div class="col-12 red-border-bar-small mb-2">Obrazy i zwiastun</div>
      </div>
      <div class="col-12 col-md-4">
          <input type="file" class="form-control form-control-sm" accept="image/png,image/jpeg" (change)="onFileSelectedSmall($event)" />
          <small >Mały plakat (PNG/JPG)</small>
          <div *ngIf="form.image" class="mt-1">
              <a [href]="form.image" target="_blank" class="badge bg-tickets">podgląd</a>
          </div>
      </div>
      <div class="col-12 col-md-4">
          <input type="file" class="form-control form-control-sm" accept="image/png,image/jpeg" (change)="onFileSelectedBig($event)" />
          <small >Duży obraz (PNG/JPG)</small>
          <div *ngIf="form.big_image" class="mt-1">
              <a [href]="form.big_image" target="_blank" class="badge bg-tickets">podgląd</a>
          </div>
      </div>
      <div class="col-12 col-md-4"><input class="form-control form-control-sm" [(ngModel)]="form.trailer" name="trailer" placeholder="URL trailera (YouTube)" required></div>


      <div class="col-12 mb-2 pb-2">
          <div class="red-border-bar-small mb-2">Wybierz kategorie (max 3):</div>
          <div class="mt-2 d-flex gap-2 align-items-center boxing">
              <div class="col-12 col-lg-9">
                  <button type="button" class="btn btn-outline-light btn-sm me-1" [class.active]="isSelected(c.id)" (click)="toggleCategory(c.id)" *ngFor="let c of categories">
                  {{ c.name }}
              </button>
              </div>
              <div class="col-12 col-lg-3 d-flex gap-2 justify-content-lg-end">
                  <input class="form-control form-control-sm w-auto" [(ngModel)]="newCategoryName" name="newCategoryName" placeholder="Nowa kategoria" />
                  <button type="button" class="btn btn-sm btn-primary" (click)="addCategory()">Dodaj kategorię</button>
              </div>
          </div>
      </div>


      <div class="col-12 d-flex justify-content-center">
        <button class="btn btn-primary me-2" type="submit" [disabled]="saving || !f.valid">Zapisz zmiany</button>
        <button type="button" class="btn btn-primary" (click)="cancelEdit(f)">Anuluj edycję</button>
      </div>
  </form>
</ng-container>

<div *ngIf="error" class="alert alert-danger">{{ error }}</div>



<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="red-border-bar-profile mb-3">Lista filmów</h2>
    <a routerLink="/admin/movies/add" class="btn btn-sm btn-primary">Dodaj nowy film</a>
</div>

<div class="table-responsive">
    <table class="table table-dark-body align-middle" style="font-size: 0.9rem;">
        <thead>
        <tr>
            <th>ID</th>
            <th>Tytuł</th>
            <th>Kategorie</th>
            <th>Czas</th>
            <th>Ocena</th>
            <th>Obrazy</th>
            <th>Trailer</th>
            <th>Obsada</th>
            <th>Akcje</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let m of movies">
            <td>{{ m.id }}</td>
            <td>{{ m.title }}</td>
            <td>
              <ng-container *ngIf="m.categories?.length; else nocat">
                <span *ngFor="let c of m.categories" class="badge bg-secondary me-1">{{ c.name }}</span>
              </ng-container>
              <ng-template #nocat>-</ng-template>
            </td>
            <td>{{ m.duration }}</td>
            <td>{{ m.rating ?? '-' }}</td>
            <td>
              <ng-container *ngIf="m.image || m.big_image; else noimg">
                <a *ngIf="m.image" [href]="m.image" target="_blank" class="badge bg-tickets">plakat</a>
                <a *ngIf="m.big_image" [href]="m.big_image" target="_blank" class="badge bg-tickets">duży</a>
              </ng-container>
              <ng-template #noimg>-</ng-template>
            </td>
            <td>
              <a *ngIf="m.trailer" [href]="m.trailer" target="_blank" class="link-light text-decoration-underline">link</a>
              <span *ngIf="!m.trailer">-</span>
            </td>
            <td class="small">{{ m.cast || '-' }}</td>
            <td>
              <button class="btn btn-sm btn-secondary btn-third me-2" (click)="editMovieStart(m)">Edytuj</button>
              <button class="btn btn-sm btn-secondary" (click)="deleteMovie(m.id)">Usuń</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>