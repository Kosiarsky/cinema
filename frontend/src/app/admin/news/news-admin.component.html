<h2 class="red-border-bar-profile mb-3">Dodaj nowy artykuł</h2>
      <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
      <div *ngIf="success" class="alert alert-success">{{ success }}</div>

      <div class="row g-2  justify-content-center">
        <div class="col-12 col-md-6 mb-3">
          <input class="form-control form-control-sm" [(ngModel)]="form.title" placeholder="Tytuł"/>
        </div>
        <div class="col-12 col-md-6 mb-3">
          <input type="date" class="form-control form-control-sm" [(ngModel)]="form.date" />
          <label class="form-label">Wybierz date artykułu</label>
        </div>
        <div class="col-12 col-md-6 mb-3">
          <input type="file" class="form-control form-control-sm" (change)="onCreateFileChange($event)" />
          <small *ngIf="uploading">Przesyłanie...</small>
          <div *ngIf="form.image" class="mt-2"><img [src]="toAbs(form.image)" style="max-height:100px"></div>
          <label class="form-label">Obraz (opcjonalnie)</label>
        </div>
        <div class="col-12 col-md-6 mb-3">
          <select class="form-select  form-select-sm" [(ngModel)]="form.movie_id">
            <option [ngValue]="null">(brak)</option>
            <option *ngFor="let m of movies" [ngValue]="m.id">{{ m.title }}</option>
          </select>
          <label class="form-label">Powiązany film (opcjonalnie)</label>
        </div>
        <div class="col-12 col-md-12 mb-3">
          <label class="form-label">Treść</label>
          <textarea class="form-control form-control-sm" rows="4" [(ngModel)]="form.content" placeholder="Treść"></textarea>
        </div>
    
        <div class="col-12 col-md-12  d-flex  justify-content-center">
            <input id="is_public" type="checkbox" class="form-check-input" [(ngModel)]="form.is_public" />
          <label for="is_public" class="form-check-label">Publiczne</label>
        </div>
        <div class="col-12 col-md-12  d-flex  justify-content-center">
            <button class="btn btn-primary mt-3 mb-3" (click)="create()" [disabled]="uploading">Dodaj artykuł</button>
        </div>
      </div>

       <h2 class="red-border-bar-profile mb-3">Lista aktualności</h2>
      <div class="table-responsive">
        <table class="table table-dark-body align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Tytuł</th>
              <th>Data</th>
              <th>Obraz</th>
              <th>Film</th>
              <th>Publiczne</th>
              <th>Akcje</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let n of list">
              <tr>
                <td>{{ n.id }}</td>
                <td *ngIf="!editing[n.id]">{{ n.title }}</td>
                <td *ngIf="editing[n.id]"><input class="form-control form-control-sm" [(ngModel)]="editing[n.id].title" /></td>

                <td *ngIf="!editing[n.id]">{{ n.date }}</td>
                <td *ngIf="editing[n.id]"><input type="date" class="form-control form-control-sm" [(ngModel)]="editing[n.id].date" /></td>

                <td>
                  <img *ngIf="!editing[n.id] && n.image" [src]="toAbs(n.image)" style="max-height:60px" />
                  <div *ngIf="editing[n.id]" class="d-flex align-items-center gap-2">
                    <img *ngIf="editing[n.id].image" [src]="toAbs(editing[n.id].image)" style="max-height:60px" />
                    <input type="file" class="form-control form-control-sm" (change)="onEditFileChange(n.id, $event)" />
                  </div>
                </td>

                <td *ngIf="!editing[n.id]">{{ n.movie?.title || '-' }}</td>
                <td *ngIf="editing[n.id]">
                  <select class="form-select form-select-sm" [(ngModel)]="editing[n.id].movie_id">
                    <option [ngValue]="null">(brak)</option>
                    <option *ngFor="let m of movies" [ngValue]="m.id">{{ m.title }}</option>
                  </select>
                </td>

                <td *ngIf="!editing[n.id]">{{ n.is_public ? 'tak' : 'nie' }}</td>
                <td *ngIf="editing[n.id]">
                  <input type="checkbox" class="form-check-input" [(ngModel)]="editing[n.id].is_public" />
                </td>

                <td>
                  <ng-container *ngIf="!editing[n.id]">
                    <button class="btn btn-sm btn-primary me-2" (click)="startEdit(n)">Edytuj</button>
                    <button class="btn btn-sm btn-secondary" (click)="remove(n.id)">Usuń</button>
                  </ng-container>
                  <ng-container *ngIf="editing[n.id]">
                    <button class="btn btn-sm btn-primary me-2" (click)="save(n.id)">Zapisz</button>
                    <button class="btn btn-sm btn-secondary" (click)="cancelEdit(n.id)">Anuluj</button>
                  </ng-container>
                </td>
              </tr>
              <tr *ngIf="editing[n.id]">
                <td colspan="7">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Treść</label>
                      <textarea class="form-control form-control-sm" rows="5" [(ngModel)]="editing[n.id].content" placeholder="Treść artykułu"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Podgląd</label>
                      <div class="p-3 announcements-card rounded">
                        <h5 class="mb-1">{{ editing[n.id].title || n.title }}</h5>
                        <small class="text-muted">{{ editing[n.id].date || n.date }}</small>
                        <div class="mt-2">
                          <img *ngIf="editing[n.id].image; else fallbackImg" [src]="toAbs(editing[n.id].image)" style="max-height:120px" />
                          <ng-template #fallbackImg>
                            <img *ngIf="n.image" [src]="toAbs(n.image)" style="max-height:120px" />
                          </ng-template>
                        </div>
                        <div class="mt-2" style="white-space: pre-line;">{{ editing[n.id].content }}</div>
                        <div class="mt-2" *ngIf="editing[n.id].movie_id || n.movie?.title">
                          <small class="text-muted">Powiązany film: {{ getMovieTitle(editing[n.id].movie_id) || n.movie?.title }}</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
